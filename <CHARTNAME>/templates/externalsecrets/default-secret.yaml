{{- if and .Values.configs.secret.create (not (empty .Values.configs.secret.data)) -}}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  labels:
    {{- include "labels" (dict "context" . "component" .Values.name "name" .Values.name) | nindent 4 }}
  name: {{ template "fullname" . }}
  namespace: {{ include  "namespace" . }}
spec:
  secretStoreRef:
    name: {{ .Values.configs.secret.secretStoreRef.name }}
    kind: ClusterSecretStore
  refreshInterval: {{ .Values.configs.secret.refreshInterval }}
  target:
    name: {{ template "fullname" . }}-default
    creationPolicy: Owner
  data:
  {{- range .Values.configs.secret.data }}
  - secretKey: {{ .secretKey }}
    remoteRef:
      key: {{ tpl (toYaml .remoteRef.key) $ }}
      version: {{ .remoteRef.version | default "latest" }}
      conversionStrategy: {{ .remoteRef.conversionStrategy | default "Default" }}
      decodingStrategy: {{ .remoteRef.decodingStrategy | default "None" }}
      metadataPolicy: {{ .remoteRef.metadataPolicy | default "None" }}
  {{- end }}
{{- end -}}
